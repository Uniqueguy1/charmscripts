<script src="https://js.paystack.co/v1/inline.js"></script>
<script>
  const modal = document.getElementById("payModal");
  const lockedCards = document.querySelectorAll(".card.locked");
  const unlockBtn = document.getElementById("unlockBtn");
  const padlocks = document.querySelectorAll(".padlock");

  // Handle locked card clicks
  lockedCards.forEach(card => {
    card.addEventListener("click", () => {
      if (localStorage.getItem("charmscripts_paid") === "true") {
        window.location.href = card.getAttribute("data-url");
      } else {
        modal.style.display = "flex";
      }
    });
  });

  // Modal close logic
  window.onclick = function(e) {
    if (e.target === modal) {
      modal.style.display = "none";
    }
  };

  // Payment function
  function payNow() {
    const handler = PaystackPop.setup({
      key: 'pk_test_b836836082db66a8849d3eb69a19da26f56bf1f1',
      email: 'user@charmscripts.com',
      amount: 100000,
      currency: 'NGN',
      callback: function(response) {
        localStorage.setItem("charmscripts_paid", "true");
        modal.style.display = "none";
        updateUnlockState();
        alert("✅ Payment successful! Premium content unlocked.");
      },
      onClose: function() {
        alert("❌ Payment was cancelled.");
      }
    });
    handler.openIframe();
  }

  // Run on load
  function updateUnlockState() {
    if (localStorage.getItem("charmscripts_paid") === "true") {
      if (unlockBtn) {
        unlockBtn.innerText = "❤️ Support Us Again";
      }
      document.querySelectorAll(".padlock").forEach(p => p.style.display = "none");
    }
  }

  // Run at page load
  document.addEventListener("DOMContentLoaded", updateUnlockState);
</script>
